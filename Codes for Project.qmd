---
title: "Project"
author: "Tina Qian, Yanlin Li"
format: pdf
---

```{r, echo = F}
library(tidyverse)
library(tidymodels)
library(readr)
library(tidyr)
library(ggplot2)

happiness <- read_csv("happiness.csv")

```
## Data Exploratory Analysis

```{r, echo = F}

happiness1 <- happiness |>
  mutate(young_members = babies + preteen + teens) |>
  select(prestige, educ, workstat, young_members, income, female, happy) |>
  mutate(Happy = case_when(
  happy == "not too happy" ~ 1,
  happy == "pretty happy" ~ 2,
  happy == "very happy" ~ 3,
  TRUE ~ NA_integer_
))

delete.na <- function(happiness1, n = 0) {
  happiness1[rowSums(is.na(happiness1)) <= n, ]
}

Happiness <- delete.na(happiness1, n = 0)

ggplot(
    data = Happiness,
    aes(x = educ, fill = as.factor(Happy))
)+
geom_bar() +
labs(x = "Highest Year of School Completed",
         y = "Number of Observations",
         title = "Distribution of participants' general happiness with
                  different highest year of school completed")

ggplot(
    data = Happiness,
    aes(x = Happy, fill = as.factor(Happy))
)+
geom_bar() +
labs(y = "Number of Observations",
         x = "General Happiness",
         title = "Distribution of participants' general happiness for both genders") +
     facet_wrap(vars(female),labeller = labeller(female = c("1" = "Females", "0" = "Males")))

ggplot(
    data = Happiness,
    aes(x = Happy, fill = as.factor(female))
)+
geom_bar() +
labs(y = "Number of Observations",
         x = "General Happiness",
         title = "Distribution of participants' general happiness with 
     different work force status, adjusted for gender") +
     facet_wrap(vars(workstat))

ggplot(
    data = Happiness,
    aes(x = Happy, fill = as.factor(Happy))
)+
geom_bar() +
labs(y = "Number of Observations",
         x = "General Happiness",
         title = "Distribution of participants' general happiness 
     with different total family income") +
     facet_wrap(vars(income))

ggplot(
    data = Happiness,
    aes(x = Happy, fill = as.factor(Happy))
)+
geom_bar() +
labs(y = "Number of Observations",
         x = "General Happiness",
         title = "Distribution of participants' general happiness 
     with different number of household members under 17") +
     facet_wrap(vars(young_members))


```
Concerning our response variable "happy," we assigned numerical rankings of "1," "2," and "3" to its three categories—"not too happy," "pretty happy," and "very happy," respectively—to facilitate analysis and model fitting.

Since we focus on the effect of socioeconomic status on happiness in our research question, we selected specific predictor variables: work force status (“workstat”), total family income (“income”), highest year of school completed (“educ”), gender (“female”), and the number of household members under 17 (“young_members”).

To create the predictor variable that records the number of household members under 17,  which was not originally included in our dataset, we aggregated data from three existing variables: the number of babies, preteens, and teenagers in the household. We believe it's more logical to consider these age groups collectively since each requires financial support and additional care from older members of the household, given that they are not yet fully independent.

Given the N/As in the “income” variable and the “young_members” variable, we used Multiple Imputation via Chained Equations (MICE) to perform multiple imputation to the data. We assume MAR is satisfied from our visual examination before.***

We generated visualizations to explore the relationships between the predictor variables and the response variable. Since most of our variables, including the response variable, are categorical, we opted for bar plots for all our exploratory data analyses.
The first bar plot examines the distribution of observations across different levels of highest year of school completed in the sample, accounting for their overall happiness. The majority of participants in the sample have completed 12-16 years of education, roughly equivalent to middle school and a high school diploma. Across almost every education level, more individuals selected "pretty happy" than "very happy" or "not too happy," possibly influenced by a tendency to prioritize these responses in general.
The second plot analyzes the distribution of observations for males and females separately, considering their overall happiness. Overall, participants tend to choose "pretty happy" more frequently than "very happy" or "not too happy," and there are more female participants in the dataset than male.
The third plot examines the distribution of observations across different work force statuses, factoring in gender and overall happiness. Most participants in the dataset are employed full-time, with only a small proportion in school, temporarily unemployed, or not working. More female participants are homemakers or work part-time compared to male participants, while gender distribution is relatively even across other work force statuses. The overall pattern of happiness preference remains consistent across genders.
The fourth plot illustrates the distribution of observations across different household income levels, considering overall happiness. The majority of participants have a household income above $10,000, especially those with incomes exceeding $25,000, who strongly favor "pretty happy" and "very happy" over "not too happy." The general pattern of happiness preference persists across all income levels.
The fifth plot displays the distribution of observations for participants with different numbers of young household members, adjusting for overall happiness. Most participants do not have anyone under 17 in their household, while those who do typically have one or two such members. The overall pattern of happiness preference remains consistent across these groups.

## Testing Interaction & Assumptions

Among these predictors, we examined two possible interactions: the interaction between work force status and gender, and that between household income and the count of household members under 17. Given the societal expectation for women to bear children and the stereotype of women primarily responsible for childcare, we anticipate a stronger correlation between being female and working part-time. Additionally, we anticipate that households with higher incomes will generally be able to support more members under 17, necessitating greater economic assistance from other family members.

 F test: 
 (all coef associated with the interaction term are equal to 0)
 
Hypothesis test:
H0: there is no interaction between working status and whether one is woman. 
Ha: there is an interaction between working status and whether one is woman. 

```{r, echo = F}


m0 <- lm(Happy ~ as.factor(workstat) + prestige + educ + young_members + as.factor(income) + 
           female,
         data = Happiness)
summary(m0)

m1 <- lm(Happy ~ as.factor(workstat) + prestige + educ + young_members + as.factor(income) + 
           female + as.factor(workstat)*female,
         data = Happiness)
summary(m1)

anova(m0, m1)

```
interpretations:

The p value for interaction term between full-time working status and female is 0.0001, which is lower than a significance level of 0.05 and statistically significant. We have sufficient evidence to reject the null hypothesis, and thus the relationship between happiness and whether one is working full-time is depended on whether the respondent is female. 

```{r, echo = F}
#Interaction between years of education and working status

m2 <- lm(Happy ~ as.factor(workstat) + prestige + educ + young_members + as.factor(income) + 
           female + + as.factor(workstat)*female + as.factor(income)*young_members,
         data = Happiness)
summary(m2)

anova(m1, m2)
```
The f statistic value 0.03 for interaction term between household income (dollars per year) and number of children (young_members) across all levels are lower than 0.05, which is not statistically significant. We have sufficient evidence to reject the null hypothesis, and thus the relationship between score of general happiness and household income (dollors per year) is depended on the number of children in the household. 

## Ordinal Regression

In our study, we contemplated employing both multinomial regression and ordinal regression models for the categorical response variable. Ultimately, we opted for the latter. The decision was straightforward, as the response variable "happy" exhibits an ordinal nature, with discernible gradations from "not too happy" to "pretty happy" to "very happy."

After assessing and confirming all the above conditions, we went into fitting the ordinal regression model.

```{r}
library(MASS)
m3 <- polr(as.factor(Happy) ~ as.factor(workstat) + educ + young_members + as.factor(income) + female, 
           data = Happiness, Hess = T)

summary(m3)
exp(coef(m3))
```
